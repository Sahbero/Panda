<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sosisli Platform Atlayışı</title>
    <style>
        body {
            margin: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f0f0f0;
            font-family: 'Comic Sans MS', 'Comic Sans', cursive;
            color: #333;
            overflow: hidden;
            user-select: none;
        }
        #gameContainer {
            position: relative;
            width: 480px;
            height: 640px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            overflow: hidden;
        }
        canvas {
            display: block;
            position: absolute;
            top: 0;
            left: 0;
        }
        #fireworksCanvas {
            z-index: 15;
            pointer-events: none;
        }
        #gameCanvas {
            z-index: 10;
        }
        #characterSelectScreen, #countdownScreen, #gameOverScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none; /* Varsayılan olarak gizli */
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: rgba(255, 255, 255, 0.95);
            z-index: 20;
            text-align: center;
        }
        #characterSelectScreen h1 {
            font-size: 2.5rem;
            margin-bottom: 30px;
            color: #555;
        }
        #characterList {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }
        .character-card {
            width: 120px;
            height: 140px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 10px;
            border: 3px solid transparent;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .character-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        .character-card.selected {
            border-color: #FF69B4;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        .character-card h3 {
            margin-top: 10px;
            font-size: 1.2rem;
        }
        #startButton, #restartButton {
            padding: 15px 30px;
            font-size: 1.5rem;
            background-color: #FF69B4;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        #startButton:hover, #restartButton:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }
        #countdownScreen p {
            font-size: 5rem;
            color: #FF69B4;
            font-weight: bold;
            animation: pulse 1s infinite;
        }
        #game-info {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 24px;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            z-index: 25;
            display: none; /* Varsayılan olarak gizli */
            gap: 15px;
            align-items: center;
        }
        #lives-container {
            display: flex;
            gap: 5px;
        }
        .heart-svg {
            width: 30px;
            height: 30px;
        }
        #celebrationMessage {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            padding: 20px 40px;
            border-radius: 15px;
            font-size: 2.5rem;
            color: #FF69B4;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5); /* Okunurluk için gölge eklendi */
            z-index: 30;
            display: none;
            opacity: 0;
            animation: bounceIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.27) forwards,
                       fadeOut 0.5s 1.5s forwards;
        }
        #gameOverScreen p {
            font-size: 3rem;
            color: #d32f2f;
            font-weight: bold;
            margin-bottom: 20px;
        }
        #final-score {
            font-size: 2rem;
            color: #555;
            margin-bottom: 30px;
        }
        #controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            width: 480px;
        }
        /* Hide controls on larger screens */
        @media (min-width: 769px) {
            #controls {
                display: none;
            }
        }
        .control-button {
            width: 80px;
            height: 80px;
            font-size: 2rem;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: background-color 0.2s ease, transform 0.1s ease;
        }
        .control-button:active {
            transform: scale(0.95);
        }
        .control-button.left, .control-button.right {
            background-color: #2196F3;
        }
        .control-button.up {
            background-color: #FFC107;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        @keyframes bounceIn {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
            60% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }
        @keyframes fadeOut {
            0% { opacity: 1; }
            100% { opacity: 0; }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas" width="480" height="640"></canvas>
        <canvas id="fireworksCanvas" width="480" height="640"></canvas>
        <div id="game-info">
            <span id="score-display">Puan: 0</span>
            <div id="lives-container"></div>
        </div>
        
        <!-- Karakter Seçim Ekranı -->
        <div id="characterSelectScreen">
            <h1>Karakterini Seç</h1>
            <div id="characterList">
                <div class="character-card" data-character="panda">
                    <!-- Panda SVG'si -->
                    <svg width="80" height="80" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><style>.ears{fill:#2b2b2b;}.face{fill:#ffffff;}.eyes{fill:#2b2b2b;}.nose{fill:#2b2b2b;}</style><circle class="ears" cx="25" cy="25" r="20"/><circle class="ears" cx="75" cy="25" r="20"/><circle class="face" cx="50" cy="50" r="40"/><circle class="eyes" cx="35" cy="45" r="8"/><circle class="eyes" cx="65" cy="45" r="8"/><path class="nose" d="M50 58 C45 62, 55 62, 50 58 M45 60 Q50 65, 55 60 T50 60"/></svg>
                    <h3>Panda</h3>
                </div>
                <div class="character-card" data-character="rabbit">
                    <!-- Tavşan görseli -->
                    <img src="tavsan.png" alt="Tavşan" width="80" height="80" id="rabbit-image" onerror="this.onerror=null;this.src='https://placehold.co/80x80/FFC0CB/000?text=Tavsan';">
                    <h3>Tavşan</h3>
                </div>
                <div class="character-card" data-character="dragon">
                    <!-- Ejderha SVG'si -->
                    <svg width="80" height="80" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><style>.head{fill:#48c774;}.eyes{fill:yellow;}.horns{fill:#805a41;}.mouth{fill:#805a41;}</style><path class="head" d="M20 60 Q50 30, 80 60 L60 80 Q50 90, 40 80 Z"/><path class="horns" d="M30 40 L25 15 L35 25 Z"/><path class="horns" d="M70 40 L75 15 L65 25 Z"/><circle class="eyes" cx="40" cy="55" r="5"/><circle class="eyes" cx="60" cy="55" r="5"/><path class="mouth" d="M40 70 C45 75, 55 75, 60 70" fill="none" stroke="red" stroke-width="2"/></svg>
                    <h3>Ejderha</h3>
                </div>
                <div class="character-card" data-character="koala">
                    <!-- Koala SVG'si -->
                    <svg width="80" height="80" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><style>.ears{fill:#7a7a7a;}.face{fill:#c2c2c2;}.eyes{fill:#333;}.nose{fill:#333;}</style><circle class="ears" cx="20" cy="20" r="20"/><circle class="ears" cx="80" cy="20" r="20"/><path class="face" d="M50 40 C20 40, 20 80, 50 80 C80 80, 80 40, 50 40 Z"/><circle class="eyes" cx="38" cy="50" r="6"/><circle class="eyes" cx="62" cy="50" r="6"/><path class="nose" d="M50 65 C45 68, 55 68, 50 65"/></svg>
                    <h3>Koala</h3>
                </div>
                <!-- Yeni karakter: Kelek -->
                <div class="character-card" data-character="kelek">
                    <img src="kelek.png" alt="Kelek" width="80" height="80" onerror="this.onerror=null;this.src='https://placehold.co/80x80/FF6347/FFF?text=Kelek';">
                    <h3>Kelek</h3>
                </div>
                <!-- Yeni karakter: Zırzop -->
                <div class="character-card" data-character="zirzop">
                    <img src="zırzop.png" alt="Zırzop" width="80" height="80" onerror="this.onerror=null;this.src='https://placehold.co/80x80/9370DB/FFF?text=Zırzop';">
                    <h3>Zırzop</h3>
                </div>
            </div>
            <button id="startButton" style="display: none;">Oyuna Başla</button>
        </div>

        <!-- Geri Sayım Ekranı -->
        <div id="countdownScreen">
            <p id="countdownDisplay"></p>
        </div>

        <!-- Kutlama Mesajı -->
        <div id="celebrationMessage"></div>

        <!-- Oyun Bitti Ekranı -->
        <div id="gameOverScreen">
            <p>Oyun Bitti!</p>
            <p id="final-score"></p>
            <button id="restartButton">Tekrar Dene</button>
        </div>
    </div>
    
    <!-- Mobil Kontrol Tuşları -->
    <div id="controls">
        <button id="leftButton" class="control-button left">◀</button>
        <button id="jumpButton" class="control-button up">▲</button>
        <button id="rightButton" class="control-button right">▶</button>
    </div>

    <script>
        // --- Oyun Sabitleri ve DOM Elemanları ---
        const gameCanvas = document.getElementById('gameCanvas');
        const fireworksCanvas = document.getElementById('fireworksCanvas');
        const ctx = gameCanvas.getContext('2d');
        const fxCtx = fireworksCanvas.getContext('2d');
        const GAME_WIDTH = gameCanvas.width;
        const GAME_HEIGHT = gameCanvas.height;
        const scoreDisplay = document.getElementById('score-display');
        const livesContainer = document.getElementById('lives-container');
        const gameInfo = document.getElementById('game-info');
        const characterSelectScreen = document.getElementById('characterSelectScreen');
        const characterCards = document.querySelectorAll('.character-card');
        const startButton = document.getElementById('startButton');
        const countdownScreen = document.getElementById('countdownScreen');
        const countdownDisplay = document.getElementById('countdownDisplay');
        const celebrationMessage = document.getElementById('celebrationMessage');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const finalScoreDisplay = document.getElementById('final-score');
        const restartButton = document.getElementById('restartButton');
        const leftButton = document.getElementById('leftButton');
        const jumpButton = document.getElementById('jumpButton');
        const rightButton = document.getElementById('rightButton');
        
        // Yaratıcı tebrik mesajları
        const CELEBRATION_MESSAGES = [
            "İnanılmazsın! Devam et!",
            "Harikasın! Yenilmezsin!",
            "Efsane bir skor!",
            "Tebrikler! Adeta uçuyorsun!",
            "Mükemmel bir başarı!",
        ];

        // --- Görsel Veriler (SVG ve Resim URL'leri) ---
        // Daha gerçekçi sosisli platform SVG'si
        const SAUSAGE_SVG = `<svg viewBox="0 0 100 30" xmlns="http://www.w3.org/2000/svg">
            <!-- Sosis ekmeği -->
            <path d="M5 25 C15 10, 85 10, 95 25 C85 30, 15 30, 5 25 Z" fill="#D2B48C"/>
            <!-- Taşmış sosis -->
            <path d="M10 20 Q50 5, 90 20" fill="#FF4500"/>
            <path d="M10 20 Q50 15, 90 20" fill="#E9967A"/>
            <!-- Hardal -->
            <path d="M20 18 Q30 15, 40 18 Q50 15, 60 18 Q70 15, 80 18" fill="#FFD700" stroke="#FFD700" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>`;
        const CLOUD_SVG = `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M10 50 A20 20 0 0 1 30 30 A25 25 0 0 1 70 30 A20 20 0 0 1 90 50 A15 15 0 0 1 75 60 L25 60 A15 15 0 0 1 10 50 Z" fill="white" fill-opacity="0.7"/></svg>`;
        const HEART_SVG = `<svg class="heart-svg" viewBox="0 0 24 24" fill="red" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>`;
        // Daha profesyonel ejderha SVG'si
        const DRAGON_SVG = `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
            <style>.head{fill:#48c774;}.eyes{fill:#f7e800;}.horns{fill:#805a41;}.mouth{fill:#805a41;}.scale{fill:#2b8d54;}</style>
            <!-- Ejderha gövdesi ve kafası -->
            <path class="head" d="M20 60 Q50 30, 80 60 L70 70 Q60 85, 50 80 Q40 85, 30 70 Z"/>
            <!-- Boynuzlar -->
            <path class="horns" d="M30 40 L25 15 L35 25 Z"/>
            <path class="horns" d="M70 40 L75 15 L65 25 Z"/>
            <!-- Gözler -->
            <circle class="eyes" cx="40" cy="55" r="5"/>
            <circle class="eyes" cx="60" cy="55" r="5"/>
            <!-- Burun delikleri -->
            <circle class="mouth" cx="45" cy="65" r="2"/>
            <circle class="mouth" cx="55" cy="65" r="2"/>
            <!-- Ağız -->
            <path class="mouth" d="M40 70 C45 75, 55 75, 60 70" fill="none" stroke="#d32f2f" stroke-width="2"/>
        </svg>`;
        const MUSHROOM_SVG = `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><style>.stem{fill:#fff}.cap{fill:#c00}.dots{fill:#fff}</style><rect class="stem" x="40" y="55" width="20" height="40"/><path class="cap" d="M20 55 C20 20, 80 20, 80 55 Z"/><circle class="dots" cx="35" cy="40" r="5"/><circle class="dots" cx="65" cy="40" r="5"/><circle class="dots" cx="50" cy="30" r="5"/></svg>`;
        // Ateş efekti için daha profesyonel bir SVG tanımlaması
        const FIRE_SVG = (size) => `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}">
            <style>
                .flame1 { fill: #ff6600; }
                .flame2 { fill: #ff9900; }
                .flame3 { fill: #ffcc00; }
            </style>
            <path class="flame1" d="M50 90 Q30 70, 40 40 Q50 20, 60 40 Q70 70, 50 90 Z" />
            <path class="flame2" d="M50 80 Q35 60, 45 35 Q50 15, 55 35 Q65 60, 50 80 Z" />
            <path class="flame3" d="M50 70 Q40 55, 50 30 Q60 55, 50 70 Z" />
        </svg>`;

        const CHARACTERS = {
            panda: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><style>.ears{fill:#2b2b2b;}.face{fill:#ffffff;}.eyes{fill:#2b2b2b;}.nose{fill:#2b2b2b;}</style><circle class="ears" cx="25" cy="25" r="20"/><circle class="ears" cx="75" cy="25" r="20"/><circle class="face" cx="50" cy="50" r="40"/><circle class="eyes" cx="35" cy="45" r="8"/><circle class="eyes" cx="65" cy="45" r="8"/><path class="nose" d="M50 58 C45 62, 55 62, 50 58 M45 60 Q50 65, 55 60 T50 60"/></svg>`,
            rabbit: 'tavsan.png',
            dragon: DRAGON_SVG,
            koala: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><style>.ears{fill:#7a7a7a;}.face{fill:#c2c2c2;}.eyes{fill:#333;}.nose{fill:#333;}</style><circle class="ears" cx="20" cy="20" r="20"/><circle class="ears" cx="80" cy="20" r="20"/><path class="face" d="M50 40 C20 40, 20 80, 50 80 C80 80, 80 40, 50 40 Z"/><circle class="eyes" cx="38" cy="50" r="6"/><circle class="eyes" cx="62" cy="50" r="6"/><path class="nose" d="M50 65 C45 68, 55 68, 50 65"/></svg>`,
            kelek: 'kelek.png',
            zirzop: 'zırzop.png'
        };

        // --- Oyun Durum Yönetimi ---
        let gameState = 'SELECT_CHARACTER';

        // --- Oyun Değişkenleri ---
        let character = {
            x: 0,
            y: 0,
            width: 40,
            height: 40,
            velocityX: 0,
            velocityY: 0,
            gravity: 0.5,
            jumpStrength: -12,
            isJumping: false,
            image: null,
            baseSpeed: 3
        };

        let platforms = [];
        let clouds = [];
        let dragons = [];
        let fireballs = [];
        let balloons = [];
        let mushrooms = [];
        let fireworks = [];
        let score = 0;
        let lives = 3;
        let lastCelebrationScore = 0;
        let lastDragonSpawnScore = 0;
        let lastBalloonsSpawnScore = 0;
        let lastMushroomSpawnScore = 0;
        let nextMushroomSpawnScore = 0; // İlk değer oyun başlangıcında atanacak
        let isSpeedBoostActive = false;
        let flashEffectActive = false;
        let flashColorIndex = 0;
        const flashColors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff'];
        let touchMoveDirection = 0; // 0: yok, 1: sağ, -1: sol

        // --- Ses Değişkenleri ---
        let deathSound;
        let mushroomSound;
        let dragonSound;
        let backgroundMusic; // Arka plan müziği için yeni değişken

        // --- Ses Dosyalarını Yükleme Fonksiyonu ---
        function loadSounds() {
            // Karakter öldüğünde çalacak ses
            deathSound = new Audio();
            deathSound.src = 'ölüm.m4a';
            // Mantar alındığında çalacak ses
            mushroomSound = new Audio();
            mushroomSound.src = 'mantar.m4a';
            // Ejderha çıktığında çalacak ses
            dragonSound = new Audio();
            dragonSound.src = 'ejderha.m4a';
            // --- Arka plan müziği ---
            backgroundMusic = new Audio();
            backgroundMusic.loop = true; // Müziğin sürekli tekrar etmesi için
            // Bu alana arka plan müziği dosyasının GitHub "Raw" (Ham) URL'sini ekleyin
            backgroundMusic.src = 'sound.mp3';
        }

        // --- Bulut Oluşturma Fonksiyonu ---
        function createClouds() {
            clouds = [];
            for (let i = 0; i < 5; i++) {
                clouds.push({
                    x: Math.random() * GAME_WIDTH,
                    y: Math.random() * GAME_HEIGHT * 0.8,
                    width: Math.random() * 80 + 100,
                    height: Math.random() * 40 + 40
                });
            }
        }

        // --- Platform Oluşturma Fonksiyonu ---
        function createPlatforms() {
            platforms = [];
            const initialPlatform = {
                x: GAME_WIDTH / 2 - 50,
                y: GAME_HEIGHT - 50,
                width: 100,
                height: 20
            };
            platforms.push(initialPlatform);

            character.x = initialPlatform.x + (initialPlatform.width / 2) - (character.width / 2);
            character.y = initialPlatform.y - character.height;

            for (let i = 0; i < 15; i++) {
                platforms.push({
                    x: Math.random() * (GAME_WIDTH - 100),
                    y: GAME_HEIGHT - 100 - i * 100,
                    width: 100,
                    height: 20
                });
            }
        }

        // --- Ejderha Oluşturma Fonksiyonu ---
        function createDragons() {
            dragons = [];
            if (score > 100) {
                const dragonY = character.y - (GAME_HEIGHT / 2);
                dragons.push({
                    x: Math.random() < 0.5 ? -100 : GAME_WIDTH + 100,
                    y: dragonY,
                    width: 80,
                    height: 80,
                    speed: 2,
                    fireballTimer: 0,
                    fireballInterval: 100 + Math.random() * 100,
                    isFacingLeft: Math.random() < 0.5
                });
            }
        }

        // --- Balon Oluşturma Fonksiyonu ---
        function createBalloons() {
            balloons = [];
            if (score > 200) {
                const balloonCount = Math.floor(Math.random() * 3) + 1;
                for (let i = 0; i < balloonCount; i++) {
                    balloons.push({
                        x: Math.random() * (GAME_WIDTH - 30),
                        y: character.y - (GAME_HEIGHT / 2) - 50 * i,
                        width: 30,
                        height: 40,
                        isCollected: false
                    });
                }
            }
        }

        // --- Mantar Oluşturma Fonksiyonu ---
        function createMushrooms() {
            mushrooms = [];
            const mushroomX = Math.random() * (GAME_WIDTH - 30);
            const mushroomY = character.y - (GAME_HEIGHT / 2);
            mushrooms.push({
                x: mushroomX,
                y: mushroomY,
                width: 30,
                height: 30,
                isCollected: false
            });
        }

        // --- Oyun Durumunu Sıfırlama Fonksiyonu ---
        function initGame() {
            gameState = 'SELECT_CHARACTER';
            hideAllScreens();
            characterSelectScreen.style.display = 'flex';
            score = 0;
            lives = 3;
            lastCelebrationScore = 0;
            lastDragonSpawnScore = 0;
            lastBalloonsSpawnScore = 0;
            lastMushroomSpawnScore = 0;
            nextMushroomSpawnScore = 150 + Math.floor(Math.random() * 100);
            isSpeedBoostActive = false;
            flashEffectActive = false;
            touchMoveDirection = 0;
            
            if (backgroundMusic) {
                backgroundMusic.pause();
                backgroundMusic.currentTime = 0;
            }

            createPlatforms();
            createClouds();
            dragons = [];
            fireballs = [];
            balloons = [];
            mushrooms = [];
            fireworks = [];
            
            drawLives();
            drawScore();
        }

        // --- Ekranları Gizleme Fonksiyonu ---
        function hideAllScreens() {
            characterSelectScreen.style.display = 'none';
            countdownScreen.style.display = 'none';
            gameOverScreen.style.display = 'none';
            gameInfo.style.display = 'none';
        }

        // --- Görseli Çizme Fonksiyonu ---
        function drawSVG(context, svgString, x, y, width, height) {
            const DOMURL = window.URL || window.webkitURL || window;
            const svg = new Blob([svgString], {
                type: 'image/svg+xml'
            });
            const url = DOMURL.createObjectURL(svg);
            const img = new Image();
            img.onload = function() {
                context.drawImage(img, x, y, width, height);
                DOMURL.revokeObjectURL(url);
            };
            img.src = url;
        }

        // --- Oyun Nesnelerini Çizme Fonksiyonu ---
        function draw() {
            ctx.clearRect(0, 0, GAME_WIDTH, GAME_HEIGHT);

            // Arka plan rengi
            ctx.fillStyle = '#87CEEB';
            ctx.fillRect(0, 0, GAME_WIDTH, GAME_HEIGHT);

            // Bulutları çiz
            clouds.forEach(cloud => {
                drawSVG(ctx, CLOUD_SVG, cloud.x, cloud.y, cloud.width, cloud.height);
            });

            // Platformları çiz
            platforms.forEach(platform => {
                // Platformun üstüne şerit efekti
                ctx.fillStyle = '#654321'; // Ekmek rengi
                ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
                ctx.fillStyle = '#ff694f'; // Sosis rengi
                ctx.fillRect(platform.x, platform.y + 5, platform.width, platform.height / 2);
                drawSVG(ctx, SAUSAGE_SVG, platform.x, platform.y, platform.width, platform.height);
            });

            // Balonları çiz
            balloons.forEach(balloon => {
                if (!balloon.isCollected) {
                    ctx.fillStyle = 'pink';
                    ctx.beginPath();
                    ctx.arc(balloon.x + balloon.width / 2, balloon.y + balloon.height / 2, balloon.width / 2, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.strokeStyle = 'red';
                    ctx.beginPath();
                    ctx.moveTo(balloon.x + balloon.width / 2, balloon.y + balloon.height);
                    ctx.lineTo(balloon.x + balloon.width / 2, balloon.y + balloon.height + 20);
                    ctx.stroke();
                }
            });

            // Mantarları çiz
            mushrooms.forEach(mushroom => {
                if (!mushroom.isCollected) {
                    drawSVG(ctx, MUSHROOM_SVG, mushroom.x, mushroom.y, mushroom.width, mushroom.height);
                }
            });

            // Ejderhaları çiz
            dragons.forEach(dragon => {
                // Ejderhayı çiz
                drawSVG(ctx, DRAGON_SVG, dragon.x, dragon.y, dragon.width, dragon.height);
            });

            // Ateş toplarını çiz
            fireballs.forEach(fireball => {
                // Daha uzun ve profesyonel ateş animasyonu
                drawSVG(ctx, FIRE_SVG(fireball.size), fireball.x, fireball.y, fireball.size, fireball.size);
            });

            // Karakteri çiz
            if (character.image) {
                // Hız artışı sırasında karakteri titreterek flash efekti uygula
                if (flashEffectActive) {
                    ctx.save();
                    ctx.shadowColor = flashColors[flashColorIndex];
                    ctx.shadowBlur = 15;
                    ctx.drawImage(character.image, character.x, character.y, character.width, character.height);
                    ctx.restore();
                } else {
                    ctx.drawImage(character.image, character.x, character.y, character.width, character.height);
                }
            }
        }

        // --- Oyun Döngüsü ---
        function gameLoop() {
            if (gameState !== 'PLAYING') return;

            update();
            draw();
            drawFireworks(); // Havai fişekleri çiz
            requestAnimationFrame(gameLoop);
        }

        // --- Oyun Mantığını Güncelleme Fonksiyonu ---
        function update() {
            // Karakterin hareketini güncelle
            character.x += character.velocityX;
            character.y += character.velocityY;
            character.velocityY += character.gravity;

            // Yan sınırlardan sekme
            if (character.x < 0 || character.x + character.width > GAME_WIDTH) {
                character.velocityX *= -1;
            }

            // Platformları yukarı kaydır
            if (character.y < GAME_HEIGHT / 2) {
                const scrollAmount = GAME_HEIGHT / 2 - character.y;
                character.y = GAME_HEIGHT / 2;

                platforms.forEach(platform => {
                    platform.y += scrollAmount;
                });
                clouds.forEach(cloud => {
                    cloud.y += scrollAmount * 0.5;
                });
                dragons.forEach(dragon => {
                    dragon.y += scrollAmount;
                });
                fireballs.forEach(fireball => {
                    fireball.y += scrollAmount;
                });
                balloons.forEach(balloon => {
                    balloon.y += scrollAmount;
                });
                mushrooms.forEach(mushroom => {
                    mushroom.y += scrollAmount;
                });

                // Yeni platformlar oluştur
                let newPlatformY = platforms[platforms.length - 1].y;
                while (newPlatformY < 0) {
                    platforms.push({
                        x: Math.random() * (GAME_WIDTH - 100),
                        y: newPlatformY - 100,
                        width: 100,
                        height: 20
                    });
                    newPlatformY -= 100;
                    score++;
                    drawScore();
                }
                
                // Skor 100 ve katı olduğunda kutlama mesajı göster
                if (score > 0 && score % 100 === 0 && score !== lastCelebrationScore) {
                    showCelebrationMessage();
                    lastCelebrationScore = score;
                }
                // Skor 500 ve katlarında havai fişekleri patlat
                if (score > 0 && score % 500 === 0) {
                    for (let i = 0; i < 10; i++) {
                        fireworks.push(new Firework());
                    }
                }
            }

            // Platform çarpışması
            platforms.forEach(platform => {
                if (
                    character.velocityY > 0 &&
                    character.x < platform.x + platform.width &&
                    character.x + character.width > platform.x &&
                    character.y + character.height > platform.y &&
                    character.y + character.height < platform.y + platform.height
                ) {
                    character.velocityY = character.jumpStrength;
                    character.isJumping = false;
                }
            });

            // Oyuncunun ekranın altına düşmesini kontrol et
            if (character.y > GAME_HEIGHT) {
                lives--;
                deathSound.play();
                drawLives();
                if (lives > 0) {
                    // Hayat varsa, oyunu sıfırla ama karakteri ve puanı koru
                    character.y = 0;
                    character.velocityY = 0;
                    createPlatforms();
                } else {
                    gameState = 'GAME_OVER';
                    backgroundMusic.pause();
                    backgroundMusic.currentTime = 0;
                    hideAllScreens();
                    gameOverScreen.style.display = 'flex';
                    finalScoreDisplay.innerText = `Skorun: ${score}`;
                }
            }
            
            // Bulutları döngüye al
            clouds = clouds.filter(cloud => cloud.y < GAME_HEIGHT);
            while (clouds.length < 5) {
                clouds.push({
                    x: Math.random() * GAME_WIDTH,
                    y: -50,
                    width: Math.random() * 80 + 100,
                    height: Math.random() * 40 + 40
                });
            }

            // Ejderha ve ateş toplarını güncelle
            if (score > 100 && score % 50 === 0 && score !== lastDragonSpawnScore) {
                createDragons();
                lastDragonSpawnScore = score;
                dragonSound.play();
            }

            dragons.forEach(dragon => {
                // Ejderha hareketini güncelle (oyuncuya doğru)
                const direction = character.x > dragon.x ? 1 : -1;
                dragon.x += dragon.speed * direction;

                // Ejderha ateş topu fırlat
                dragon.fireballTimer++;
                if (dragon.fireballTimer >= dragon.fireballInterval) {
                    fireballs.push({
                        x: dragon.x + dragon.width / 2,
                        y: dragon.y + dragon.height,
                        size: 20,
                        velocityY: 5,
                        velocityX: 0
                    });
                    dragon.fireballTimer = 0;
                    dragon.fireballInterval = 100 + Math.random() * 100;
                }
            });

            // Ateş toplarını güncelle ve çarpışma kontrolü
            fireballs = fireballs.filter(fireball => fireball.y < GAME_HEIGHT);
            fireballs.forEach(fireball => {
                fireball.y += fireball.velocityY;
                if (
                    character.x < fireball.x + fireball.size &&
                    character.x + character.width > fireball.x &&
                    character.y < fireball.y + fireball.size &&
                    character.y + character.height > fireball.y
                ) {
                    lives--;
                    deathSound.play();
                    drawLives();
                    fireball.y = GAME_HEIGHT + 1; // Ateş topunu ekran dışına taşı
                    // Can biterse oyun biter
                    if (lives <= 0) {
                        gameState = 'GAME_OVER';
                        backgroundMusic.pause();
                        backgroundMusic.currentTime = 0;
                        hideAllScreens();
                        gameOverScreen.style.display = 'flex';
                        finalScoreDisplay.innerText = `Skorun: ${score}`;
                    } else {
                        // Eğer hayatı varsa, bir saniyeliğine hız artışı ver ve flash efekti uygula
                        character.velocityY = -20;
                        isSpeedBoostActive = true;
                        flashEffectActive = true;
                        setTimeout(() => {
                            isSpeedBoostActive = false;
                            flashEffectActive = false;
                        }, 1000);
                    }
                }
            });

            // Balonları güncelle
            if (score > 200 && score % 100 === 0 && score !== lastBalloonsSpawnScore) {
                createBalloons();
                lastBalloonsSpawnScore = score;
            }

            balloons.forEach(balloon => {
                if (
                    !balloon.isCollected &&
                    character.x < balloon.x + balloon.width &&
                    character.x + character.width > balloon.x &&
                    character.y < balloon.y + balloon.height &&
                    character.y + character.height > balloon.y
                ) {
                    lives++;
                    drawLives();
                    balloon.isCollected = true;
                    // Balon toplanınca havai fişek efekti
                    for (let i = 0; i < 5; i++) {
                        fireworks.push(new Firework(balloon.x, balloon.y, 5));
                    }
                }
            });
            balloons = balloons.filter(b => !b.isCollected && b.y < GAME_HEIGHT);

            // Mantarları güncelle
            if (score > nextMushroomSpawnScore && score % 10 !== 0) { // Skor belli bir seviyeye gelince ve her puan artışında kontrol et
                createMushrooms();
                lastMushroomSpawnScore = score;
                nextMushroomSpawnScore = score + 150 + Math.floor(Math.random() * 100);
            }

            mushrooms.forEach(mushroom => {
                if (
                    !mushroom.isCollected &&
                    character.x < mushroom.x + mushroom.width &&
                    character.x + character.width > mushroom.x &&
                    character.y < mushroom.y + mushroom.height &&
                    character.y + character.height > mushroom.y
                ) {
                    score += 50;
                    drawScore();
                    mushroomSound.play();
                    mushroom.isCollected = true;
                    // Mantar toplanınca havai fişek efekti
                    for (let i = 0; i < 5; i++) {
                        fireworks.push(new Firework(mushroom.x, mushroom.y, 5));
                    }
                }
            });
            mushrooms = mushrooms.filter(m => !m.isCollected && m.y < GAME_HEIGHT);

            // Havai fişekleri güncelle
            fireworks.forEach(firework => firework.update());
            fireworks = fireworks.filter(firework => firework.particles.length > 0);
            
            // Hız artışı aktifse karakter hızını artır
            if (isSpeedBoostActive) {
                character.baseSpeed = 6;
                flashColorIndex = (flashColorIndex + 1) % flashColors.length;
            } else {
                character.baseSpeed = 3;
            }
        }

        // --- Puanı Çizme Fonksiyonu ---
        function drawScore() {
            scoreDisplay.innerText = `Puan: ${score}`;
        }

        // --- Canları Çizme Fonksiyonu ---
        function drawLives() {
            livesContainer.innerHTML = '';
            for (let i = 0; i < lives; i++) {
                livesContainer.innerHTML += HEART_SVG;
            }
        }

        // --- Kutlama Mesajı Gösterme Fonksiyonu ---
        function showCelebrationMessage() {
            celebrationMessage.style.display = 'block';
            celebrationMessage.innerText = CELEBRATION_MESSAGES[Math.floor(Math.random() * CELEBRATION_MESSAGES.length)];
            setTimeout(() => {
                celebrationMessage.style.display = 'none';
            }, 2000); // 2 saniye sonra mesajı gizle
        }

        // --- Havai Fişek Sınıfı ---
        class Firework {
            constructor(x = GAME_WIDTH / 2, y = GAME_HEIGHT / 2, size = 3) {
                this.x = x;
                this.y = y;
                this.size = size;
                this.hue = Math.random() * 360;
                this.particles = [];
                this.createParticles();
            }

            createParticles() {
                for (let i = 0; i < 100; i++) {
                    this.particles.push(new Particle(this.x, this.y, this.hue, this.size));
                }
            }

            update() {
                this.particles.forEach(particle => particle.update());
                this.particles = this.particles.filter(particle => particle.alpha > 0);
            }
        }

        // --- Parçacık Sınıfı ---
        class Particle {
            constructor(x, y, hue, size) {
                this.x = x;
                this.y = y;
                this.size = size;
                this.speed = Math.random() * 5 + 1;
                this.angle = Math.random() * 2 * Math.PI;
                this.velocityX = this.speed * Math.cos(this.angle);
                this.velocityY = this.speed * Math.sin(this.angle);
                this.alpha = 1;
                this.friction = 0.99;
                this.gravity = 0.05;
                this.hue = hue;
            }

            update() {
                this.velocityX *= this.friction;
                this.velocityY *= this.friction;
                this.velocityY += this.gravity;
                this.x += this.velocityX;
                this.y += this.velocityY;
                this.alpha -= 0.01;
            }
        }

        // --- Havai Fişekleri Çizme Fonksiyonu ---
        function drawFireworks() {
            fxCtx.clearRect(0, 0, GAME_WIDTH, GAME_HEIGHT);
            fireworks.forEach(firework => {
                firework.particles.forEach(particle => {
                    fxCtx.save();
                    fxCtx.globalAlpha = particle.alpha;
                    fxCtx.fillStyle = `hsl(${particle.hue}, 100%, 50%)`;
                    fxCtx.beginPath();
                    fxCtx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
                    fxCtx.fill();
                    fxCtx.restore();
                });
            });
        }

        // --- Karakter Görselini Ayarlama Fonksiyonu ---
        function setCharacterImage(characterName) {
            let svgString = CHARACTERS[characterName];
            if (svgString.startsWith('<svg')) {
                const DOMURL = window.URL || window.webkitURL || window;
                const svg = new Blob([svgString], {
                    type: 'image/svg+xml'
                });
                const url = DOMURL.createObjectURL(svg);
                character.image = new Image();
                character.image.onload = function() {
                    DOMURL.revokeObjectURL(url);
                    startCountdown();
                };
                character.image.src = url;
            } else {
                character.image = new Image();
                character.image.onerror = function() {
                    this.src = `https://placehold.co/${character.width}x${character.height}/000/FFF?text=${characterName}`;
                    startCountdown();
                };
                character.image.src = svgString;
            }
        }

        // --- Klavye ve Dokunmatik Kontrol Yönetimi ---
        let keys = {};
        document.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            if (e.key === 'ArrowUp' && !character.isJumping) {
                character.isJumping = true;
                character.velocityY = character.jumpStrength;
            }
        });
        document.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });

        // Kontrolleri güncelleme fonksiyonu
        function handleControls() {
            character.velocityX = 0;
            if (keys['ArrowLeft'] || touchMoveDirection === -1) {
                character.velocityX = -character.baseSpeed;
            }
            if (keys['ArrowRight'] || touchMoveDirection === 1) {
                character.velocityX = character.baseSpeed;
            }
            if (keys['ArrowUp'] && !character.isJumping) {
                character.isJumping = true;
                character.velocityY = character.jumpStrength;
            }
        }
        
        // Mobil dokunmatik kontroller
        leftButton.addEventListener('touchstart', (e) => { e.preventDefault(); touchMoveDirection = -1; });
        leftButton.addEventListener('touchend', (e) => { e.preventDefault(); touchMoveDirection = 0; });
        rightButton.addEventListener('touchstart', (e) => { e.preventDefault(); touchMoveDirection = 1; });
        rightButton.addEventListener('touchend', (e) => { e.preventDefault(); touchMoveDirection = 0; });
        jumpButton.addEventListener('touchstart', (e) => { e.preventDefault(); character.isJumping = true; character.velocityY = character.jumpStrength; });

        // --- Oyun Başlangıç ve Menü Yönetimi ---
        let selectedCharacter = null;
        loadSounds();

        characterCards.forEach(card => {
            card.addEventListener('click', () => {
                characterCards.forEach(c => c.classList.remove('selected'));
                card.classList.add('selected');
                selectedCharacter = card.dataset.character;
                startButton.style.display = 'block';
            });
        });
        
        function startCountdown() {
            hideAllScreens();
            countdownScreen.style.display = 'flex';
            let count = 3;
            countdownDisplay.innerText = count;

            const countdownInterval = setInterval(() => {
                count--;
                if (count > 0) {
                    countdownDisplay.innerText = count;
                } else {
                    clearInterval(countdownInterval);
                    gameState = 'PLAYING';
                    hideAllScreens();
                    gameInfo.style.display = 'flex';
                    drawLives();
                    drawScore();
                    // Oyun müziğini başlat
                    if (backgroundMusic) {
                        backgroundMusic.play();
                    }
                    gameLoop();
                }
            }, 1000);
        }

        startButton.addEventListener('click', () => {
            if (selectedCharacter) {
                // Oyunu sıfırla, sonra karakteri yükle ve geri sayımı başlat
                initGame();
                setCharacterImage(selectedCharacter);
            }
        });
        
        restartButton.addEventListener('click', () => {
            initGame();
        });
        
        // Oyun başlatılmadan önce ilk ekranı göster
        initGame();
    </script>
</body>
</html>
